<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadoo: Sudoku Challenge</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }
    .container {
      max-width: 600px;
      width: 100%;
      padding: 1rem;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .sudoku-grid {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      width: 100%;
      max-width: 540px;
      height: 540px;
      margin: 0 auto;
      border: 2px solid #333;
      background: #fff;
    }
    .cell {
      border: 1px solid #ccc;
      text-align: center;
      font-size: clamp(1rem, 4vw, 1.5rem);
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 0;
      min-width: 0;
    }
    .cell.fixed {
      background-color: #e6ecf0;
    }
    .cell.selected {
      background-color: #cce5ff;
    }
    .cell:nth-child(3n) {
      border-right: 2px solid #333;
    }
    .cell:nth-child(n+19):nth-child(-n+27),
    .cell:nth-child(n+46):nth-child(-n+54) {
      border-bottom: 2px solid #333;
    }
    .number-pad {
      margin-top: 2rem;
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 10px;
    }
    .number-button {
      width: 50px;
      height: 70px;
      font-size: 1.25rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 0;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .number-button:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .number-button .count {
      font-size: 0.875rem;
      color: #666;
    }
    @media (max-width: 576px) {
      .container {
        padding: 0.5rem;
      }
      .top-bar {
        font-size: 0.9rem;
        padding: 0.75rem;
      }
      .sudoku-grid {
        height: 400px;
        max-width: 400px;
      }
      .number-button {
        width: 40px;
        height: 60px;
        font-size: 1rem;
      }
      .number-button .count {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
<div class="container text-center">
  <div class="top-bar">
    <div>‚úÖ Correct: <span id="correctCount">0</span></div>
    <div>‚ùå Wrong: <span id="wrongCount">0</span></div>
  </div>
  <div class="sudoku-grid" id="sudoku-board"></div>
  <div class="number-pad" id="number-pad"></div>
</div>

<script>
  let solution = [];
  let puzzle = [];
  let wrongMoves = 0;
  let correctMoves = 0;
  let selectedCell = null;
  let remainingCounts = new Array(9).fill(0);

  function isSafe(board, row, col, num) {
    for (let x = 0; x < 9; x++) {
      if (board[row][x] === num || board[x][col] === num) return false;
    }
    const startRow = row - row % 3, startCol = col - col % 3;
    for (let i = 0; i < 3; i++) {
      for (let j = 0; j < 3; j++) {
        if (board[i + startRow][j + startCol] === num) return false;
      }
    }
    return true;
  }

  function generateFullBoard() {
    let board = Array.from({ length: 9 }, () => Array(9).fill(null));
    function solve(board) {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (board[row][col] === null) {
            for (let num = 1; num <= 9; num++) {
              if (isSafe(board, row, col, num)) {
                board[row][col] = num;
                if (solve(board)) return true;
                board[row][col] = null;
              }
            }
            return false;
          }
        }
      }
      return true;
    }
    solve(board);
    return board;
  }

  function generatePuzzle(fullBoard, minClues = 25) {
    let puzzle = JSON.parse(JSON.stringify(fullBoard));
    let cells = [];
    for (let i = 0; i < 9; i++) for (let j = 0; j < 9; j++) cells.push([i, j]);

    for (let i = cells.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [cells[i], cells[j]] = [cells[j], cells[i]];
    }

    let removed = 0;
    while (removed < 81 - minClues && cells.length > 0) {
      const [row, col] = cells.pop();
      const temp = puzzle[row][col];
      puzzle[row][col] = null;

      let testPuzzle = JSON.parse(JSON.stringify(puzzle));
      if (!hasUniqueSolution(testPuzzle)) {
        puzzle[row][col] = temp;
      } else {
        removed++;
      }
    }
    return puzzle;
  }

  function hasUniqueSolution(board) {
    function solve(board) {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (board[row][col] === null) {
            for (let num = 1; num <= 9; num++) {
              if (isSafe(board, row, col, num)) {
                board[row][col] = num;
                if (solve(board)) {
                  return true;
                }
                board[row][col] = null;
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    let solutions = 0;
    function countSolutions(board) {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (board[row][col] === null) {
            for (let num = 1; num <= 9; num++) {
              if (isSafe(board, row, col, num)) {
                board[row][col] = num;
                if (countSolutions(board)) {
                  solutions++;
                  if (solutions > 1) return true;
                }
                board[row][col] = null;
              }
            }
            return solutions <= 1;
          }
        }
      }
      solutions++;
      return solutions <= 1;
    }

    let testBoard = JSON.parse(JSON.stringify(board));
    return countSolutions(testBoard);
  }

  function calculateRemainingCounts() {
    let totalCounts = new Array(9).fill(0);
    for (let row = 0; row < 9; row++) {
      for (let col = 0; col < 9; col++) {
        if (solution[row][col] !== null) {
          totalCounts[solution[row][col] - 1]++;
        }
      }
    }
    let usedCounts = new Array(9).fill(0);
    for (let row = 0; row < 9; row++) {
      for (let col = 0; col < 9; col++) {
        if (puzzle[row][col] !== null) {
          usedCounts[puzzle[row][col] - 1]++;
        }
      }
    }
    for (let i = 0; i < 9; i++) {
      remainingCounts[i] = totalCounts[i] - usedCounts[i];
    }
  }

  function renderBoard(board) {
    const boardDiv = document.getElementById('sudoku-board');
    boardDiv.innerHTML = '';
    board.forEach((row, rowIndex) => {
      row.forEach((cell, colIndex) => {
        const cellDiv = document.createElement('div');
        cellDiv.classList.add('cell');
        if (cell !== null) {
          cellDiv.classList.add('fixed');
          cellDiv.textContent = cell;
        } else {
          cellDiv.dataset.row = rowIndex;
          cellDiv.dataset.col = colIndex;
          cellDiv.addEventListener('click', handleCellClick);
        }
        boardDiv.appendChild(cellDiv);
      });
    });
  }

  function renderNumberPad() {
    const pad = document.getElementById('number-pad');
    pad.innerHTML = '';
    for (let i = 1; i <= 9; i++) {
      const btn = document.createElement('button');
      btn.className = 'number-button';
      btn.innerHTML = `${i}<div class="count">${remainingCounts[i-1]}</div>`;
      btn.addEventListener('click', () => handleNumberClick(i));
      pad.appendChild(btn);
    }
  }

  function handleCellClick(e) {
    if (selectedCell) selectedCell.classList.remove('selected');
    selectedCell = e.target;
    selectedCell.classList.add('selected');
  }

  function handleNumberClick(num) {
    if (!selectedCell) return;
    const row = parseInt(selectedCell.dataset.row);
    const col = parseInt(selectedCell.dataset.col);
    if (solution[row][col] === num) {
      selectedCell.textContent = num;
      selectedCell.classList.add('bg-success', 'text-white');
      selectedCell.classList.remove('selected');
      selectedCell.removeEventListener('click', handleCellClick);
      correctMoves++;
      remainingCounts[num-1]--;
      document.getElementById('correctCount').textContent = correctMoves;
    } else {
      selectedCell.classList.add('bg-danger', 'text-white');
      setTimeout(() => selectedCell.classList.remove('bg-danger', 'text-white'), 500);
      wrongMoves++;
      document.getElementById('wrongCount').textContent = wrongMoves;
      if (wrongMoves >= 3) {
        setTimeout(() => {
          alert("Come on, you're smart üòé ‚Äî but you lost. Try again!");
          location.reload();
        }, 300);
      }
    }
    renderNumberPad();
    selectedCell = null;
  }

  solution = generateFullBoard();
  puzzle = generatePuzzle(solution, 25); // Adjusted to 25 clues for hard difficulty
  calculateRemainingCounts();
  renderBoard(puzzle);
  renderNumberPad();
</script>
</body>
</html>